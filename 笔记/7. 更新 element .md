#	更新入口

effect 中的 fn 包含 render 函数的执行，render 函数是中的响应式数据进行 get 操作，会收集依赖，也就是该 effect 实例。

> 通过在 组件实例 上设置 isMounted，可以判断当前组件是 初始化 还是 更新。更新的话会创建新的 vnode，然后进行 patch 更新。

![](https://raw.githubusercontent.com/qiulengshuo/images/master/20220605122406.png)

#	更新 element 的 props

主函数是 patchProps。

![](https://raw.githubusercontent.com/qiulengshuo/images/master/20220605122810.png)

##	patchProps

###	先在 newProps 遍历

1. 两值不同，直接更新。
2. 新 prop null 或 undefined，删除对应属性。
3. 新增属性，直接添加。

###	再在 oldProps 遍历

1. 只需要去删除 newProps 中没有的。

![](https://raw.githubusercontent.com/qiulengshuo/images/master/20220605122846.png)

![](https://raw.githubusercontent.com/qiulengshuo/images/master/20220605123208.png)

#	更新 element 的 children

 ##	patchChildren

1. 当更新后的 children 为 text。

​		a.	旧 children 为 array，先删除已有元素，后添加 textContext。

​		b.	旧 children 为 text，更新 textContent。

2. 当更新后的 children 为 array。

​		a.	旧 children 为 text，初始化 children。

​		b.	旧 children 为 array，走 patchKeyedChildren 。

![](https://raw.githubusercontent.com/qiulengshuo/images/master/20220605204610.png)

##	patchKeyedChildren

###	双端对比

1. 左侧对比，直到停到不同 node 的下标。
2. 右侧对比，直到停到不同 node 的下标。

###	新的比老的多，多的 node 都在一端

设置锚点 anchor，在对应元素前面插入即可。

![](https://raw.githubusercontent.com/qiulengshuo/images/master/20220605205015.png)

###	老的比新的多，多的 node 都在一端

直接循环删除即可。

![image-20220605205029243](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220605205029243.png)

###	差异的 node 在中间

